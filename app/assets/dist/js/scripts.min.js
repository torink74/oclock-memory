let previousReturnedCard=null,progressBar=document.getElementById("progress-bar"),gameSettings=document.getElementById("game-settings"),startTime=null;function addGameListeners(){gameSettings.addEventListener("submit",gameLoop)}function addCardListeners(){document.querySelectorAll(".card").forEach(function(e){e.addEventListener("click",handleClickOnCard)})}function removeCardListeners(){document.querySelectorAll(".card").forEach(function(e){e.removeEventListener("click",handleClickOnCard)})}function isGameWon(){return!(document.querySelectorAll(".hide").length>0)}function gameOver(){let e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status&&(alert("Aie, tu n'as pas été assez rapide ! Essayes de modifier le temps de ta partie !"),document.getElementById("game-board").innerHTML=this.response)},e.open("POST","",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("game-over=1")}function displayCard(e){return new Promise(t=>setTimeout(t,e))}async function handleCardAction(e){if(e.classList.remove("hide"),null!==previousReturnedCard)if(previousReturnedCard.dataset.letter===e.dataset.letter)previousReturnedCard=null,e.classList.add("hide");else{if(e.dataset.letter.substr(0,1)===previousReturnedCard.dataset.letter.substr(0,1)){if(e.classList.add("found"),previousReturnedCard.classList.add("found"),isGameWon()){progressBar.style.animationPlayState="paused";let e=(new Date).getTime()-startTime,t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&200===this.status&&(alert("Bravo champion ! Essayes de modifier la durée de la partie pour plus de challenge !"),document.getElementById("game-board").innerHTML=this.response)},t.open("POST","",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("game-over=1&time="+e)}}else removeCardListeners(),await displayCard(2e3),e.classList.add("hide"),previousReturnedCard.classList.add("hide"),addCardListeners();previousReturnedCard=null}else previousReturnedCard=e}function handleClickOnCard(e){let t=e.target;t.classList.contains("found")||handleCardAction(t)}function gameLoop(e){e.preventDefault();let t=document.getElementById("scores");null!==t&&t.remove();let n=new XMLHttpRequest;n.open("POST","",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("new-game=1"),n.onreadystatechange=function(){4===this.readyState&&200===this.status&&(document.getElementById("game-board").innerHTML=this.response,addCardListeners())},startTime=(new Date).getTime(),progressBar.style.animation="none",progressBar.offsetHeight,progressBar.style.animation="progressbar-countdown";let a=document.getElementById("time").value;progressBar.style.animationDuration=a+"s",progressBar.style.animationPlayState="running"}progressBar.addEventListener("animationend",gameOver),addGameListeners();